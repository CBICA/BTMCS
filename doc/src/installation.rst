.. raw:: html

   <!--

   ============================================================================

      DO NOT EDIT THIS FILE! It was generated using Sphinx from:

      Origin:   $URL$
      Revision: $Rev$

   ============================================================================

   -->

.. title:: Installation of BTMCS Software

.. meta::
   :description: How to install BTMCS software, a step-by-step guide.
   :keywords: BTMCS Installation, BTMCS Install, BTMCS Configuration, BTMCS Setup.

   
.. raw:: latex

    \pagebreak

.. role:: red
.. role:: blue
   
   
.. raw:: html

    <br />

Installation
============

.. raw:: html

    <br />


The following steps describe the procedure to build and install BrainTumorModeling_CoupledSolver (BTMCS).

Build Dependencies
------------------

Before building BTMCS, the following software libraries are required to be installed.

.. The tabularcolumns directive is required to help with formatting the table properly
   in case of LaTeX (PDF) output.

.. tabularcolumns:: |p{3cm}|m{3cm}|p{9cm}|

+------------+------------------+-----------------------------------------------------+
| Package    | Version          | Description                                         |
+============+==================+=====================================================+
| CMake_     | 2.8.4 or higher  | To compile and build BTMCS. Use version             |
|            |                  | 2.8.4 or higher.                                    |
+------------+------------------+-----------------------------------------------------+
| PETSc_     | 2.2.1 or higher  | BTMCS is built upon the structure of PETSc_.        |
|            |                  | In Windows, use version 3.2 or higher.              |
+------------+------------------+-----------------------------------------------------+
| ITK_       | 3.14 or higher   | For ITK 3.x or 4.x, there's no mandatory option.    |
|            |                  | Required only when ``BUILD_TESTING`` is enabled in  |
|            |                  | CMake_ setting of BTMCS.                            |
|            |                  | In Windows, build using CMake GUI with              |
|            |                  | the Win64 (x64) solution platform of Visual Studio. | 
+------------+------------------+-----------------------------------------------------+

.. raw:: html

    <br />


Build PETSc
-----------

BTMCS is built upon the PETSc_ library. PETSc_ library could be built as static libraries as follows. The advantage of static libraries is that once the application program is compiled and linked, the PETSc files could be removed as they are not required for the execution of the program. Here, we use the version 3.5.2 by an example (this procedure also works on versions >= 3.2).

.. note::

    To open the shell in Windows, launch the command prompt by executing ``Visual Studio x64 Win64 Command Prompt`` in ``Start > All Programs > Microsoft Visual Studio > Visual Studio Tools``. In this prompt, type ``C:\cygwin\bin\bash --login`` to open the Cygwin_ terminal. In the cygwin terminal, execute ``mv /usr/bin/link.exe /usr/bin/link-cygwin.exe`` to avoid the confusion with the Visual Studio link program. Alternatively, move ``/usr/bin`` folder to the end in the ``PATH`` variable so that Visual Studio's link program could be found first. See the Windows_installation_of_PETSc_ for further details.


.. raw:: html

    <br />

    
**Step 1. Download and extract source files**::

    wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-3.5.2.tar.gz
    tar xvf petsc-3.5.2.tar.gz
    cd petsc-3.5.2

    
.. raw:: html

    <br />

    
**Step 2. Configure**::

    ./configure --with-mpi=0 --with-shared-libraries=0 --with-debugging=0

.. note::

    The name of the compiler could be specified by ``--with-cc=`` and ``--with-fc=`` options. To download LAPACK_ during building, append ``--download-fblaslapack``. If a fortran compiler is not available, try ``--with-fc=0 --download-f2cblaslapack``. In Windows, append ``--with-cc='win32fe cl' --with-fc=0 --with-cxx='win32fe cl' --download-f2cblaslapack`` option.
    
.. note::

    Although the MPI option is turned off above, it is okay with the MPI option enabled. For the details of the MPI option or other further details, see installation_instructions_of_PETSc_.

    
.. raw:: html

    <br /> 

    
**Step 3. Build**::

    export PETSC_DIR=$PWD
    export PETSC_ARCH=arch-linux2-c-opt
    make

.. note::

    Change ``arch-linux2-c-opt`` for ``PETSC_ARCH`` to the value corresponding to your system as reported by the configure procedure. For example, use ``export PETSC_ARCH=arch-mswin-c-opt`` in Windows.

    
.. raw:: html

    <br /> 


Build BTMCS
-----------

Please follow commands below in a shell/terminal (e.g., Bash_). They will configure and build BTMCS using `GNU Make`_. The main CMake configuration file (``CMakeLists.txt``) is located in the root directory of the package. This CMake installation is supported on BTMCS version 1.2.1 of higher.

.. note::

    To build in Windows, use CMake GUI with the Win64 (x64) solution platform of Visual Studio. The selected solution platform is needed to match with dependent libraries.

.. raw:: html

    <br />

    
**Step 1. Extract source files and create the build directory**::

    tar xvf braintumormodeling_coupledsolver-${version}-source.tar.gz
    mkdir braintumormodeling_coupledsolver-${version}-build
    cd braintumormodeling_coupledsolver-${version}-build

.. note::

    In Windows, use the appropriate zip program (e.g., 7-zip_) to extract.
	
.. raw:: html

    <br />	
	
    
**Step 2. Run CMake to configure the build tree**::

    ccmake ../braintumormodeling_coupledsolver-${version}-source

In the CMake interface, follow these steps:

2.1.  Change ``CMAKE_INSTALL_PREFIX`` to the folder you want to install BTMCS into. This folder should be outside the ``braintumormodeling_coupledsolver-${version}-source`` folder. Make sure you have the **write** access to this folder. Change ``CMAKE_BUILD_TYPE`` (or ``CMAKE_CONFIGURATION_TYPES``) to ``Release``. Change ``PETSC_DIR`` and ``PETSC_ARCH`` to appropriate values. Locate ``ITK_DIR`` to the appropriate folder if ``BUILD_TESTING`` set ``ON``.

2.2.  Keep pressing letter ``c`` on your keyboard until option ``g`` is available/displayed on the screen.

2.3.  Then press ``g`` on your keyboard to generate the makefiles and to quit this ccmake window.

.. note::

    In the CMake GUI, ``c`` and ``g`` correspond to ``Configure`` and ``Generate`` buttons. In Windows, use ``/`` for the directory seperator in ``PETSC_DIR``. Also, set ``C:/cygwin/bin/make.exe`` for ``MAKE_EXECUTABLE`` if it could not be found automatically.
 
.. raw:: html

    <br /> 

    
**Step 3. Build**::

    make

.. note::

    In Windows, launch the solution file of Visual Studio, select ``Release`` in the solution configurations (and confirm ``x64`` in the soultion platforms), and then perform the rebuild solution.


.. raw:: html

    <br /> 


**Step 4. Test (optional)**::

    make test

.. note::

	In Windows, build the ``RUN_TESTS`` project. To perform tests, the ``BUILD_TESTING`` option in the CMake configuration is required to set ``ON``. 

In case of failing tests, re-run the tests, but this time by executing CTest_ directly with the ``-V`` option to enable verbose output and redirect the output to a text file: ::
	
	ctest -V >& btmcs-test.log

And send the file ``btmcs-test.log`` as attachment of the issue report to ``sbia-software at uphs.upenn.edu``.


.. raw:: html

    <br /> 

**Step 5. Install**::

    make install

.. note::

    In Windows, build the ``INSTALL`` project.


.. raw:: html

    <br /> 


Upon the success of the above compilation and build process, BTMCS is installed into the directory specified by the ``CMAKE_INSTALL_PREFIX`` (set during build configuration in step 3).


.. raw:: html

    <br />


.. _PETSc:      http://www.mcs.anl.gov/petsc/
.. _CMake:      http://www.cmake.org/
.. _CTest: 		http://www.cmake.org/cmake/help/v2.8.8/ctest.html
.. _GNU Make:   http://www.gnu.org/software/make/
.. _ITK:        http://www.itk.org/ITK/resources/software.html
.. _LAPACK:     http://www.netlib.org/lapack/
.. _Bash:       http://www.gnu.org/software/bash/
.. _7-zip:      http://www.7-zip.org/
.. _Cygwin:     http://www.cygwin.com/
.. _BASH:       http://www.gnu.org/software/bash/
.. _installation_instructions_of_PETSc: http://www.mcs.anl.gov/petsc/petsc-as/documentation/installation.html
.. _Windows_installation_of_PETSc: http://www.mcs.anl.gov/petsc/documentation/installation.html#windows
